class Services {
  static list = {
    "Obalový design": {
      key: "obalovy_design",
      blurb: "Specializujeme se na obaly pro potraviny, nápoje a kosmetiku.",
      // blurb: "Obalované řízky...teda, obaly na obalované řízky!",
      description: `
      • Grafický návrh nových obalů
      • Redesign stávajících obalů
      • Návrh krabiček a prodejních kartonů
      • Příprava tiskových podkladů pro výrobu
      `,
      examples: [
        {src: "../images/carousel/obal_1.jpg", projectName: "vest", hasBrightBG: true},
        {src: "../images/carousel/3d_2.jpg", projectName: "karima"},
        {src: "../images/carousel/3d_3.jpg", projectName: "henna"},
        {src: "../images/carousel/3d_4.jpg", projectName: "agro_jesenice"},
        {src: "../images/carousel/3d_6.jpg", projectName: "kralovske_marmelady"},
        // {src: "../images/carousel/3d_7.jpg", projectName: "vest"},
      ]
    },



    "Grafický design": {
      key: "graficky_design",
      blurb: "Navrhneme letáky, katalogy, plakáty a další...",
      description: `
      • firemní identita
      • grafický logomanuál
      • firemní tiskoviny - nabídkové listy, katalogy, vizitky atd.
      • inzeráty, billboardy, plakáty
      `,
      examples: [
        {src: "../images/carousel/graf_1.jpg", projectName: "adria_gold", hasBrightBG: true, hasBrightSubject: true},
        {src: "../images/carousel/graf_2.jpg", projectName: "napacider",  hasBrightBG: true, hasBrightSubject: true},
        {src: "../images/carousel/graf_3.jpg", projectName: "kovacs",     hasBrightBG: true, hasBrightSubject: true},
        {src: "../images/carousel/graf_4.jpg", projectName: "kovacs",     hasBrightBG: true, hasBrightSubject: true},
      ]
    },



    "Logo a identita": {
      key: "logo_design",
      blurb: "Vytvoříme logo pro vaši firmu či produkt.",
      description: `
      • Navrhneme vám nové logo a identitu
      • Zmodernizujeme vaši starou identitu
      • Vytvoříme loga pro nové produkty
      `,
      examples: [
        {src: "../images/carousel/logo_1.jpg", projectName: "kovacs",     hasBrightBG: true, hasBrightSubject: true},
        {src: "../images/carousel/logo_2.jpg", projectName: "adria_gold", hasBrightBG: true, hasBrightSubject: true},
        {src: "../images/carousel/logo_6.jpg", projectName: "la_food",    hasBrightBG: true, hasBrightSubject: true},
        {src: "../images/carousel/logo_7.jpg", projectName: "la_food",    hasBrightBG: true, hasBrightSubject: true},
      ]
    },



    "Produkce": {
      key: "produkce",
      blurb: "Vyrobíme cokoliv - tiskoviny, POP a POS materiály...",
      description: `
      Dokážeme pro vás zajistit kompletní produkci, rychle a spolehlivě dodáme všechny navržené materiály.
      • tiskoviny - katalogy, vizitky, plakáty
      • roll-upy, ochutnávkové stolky, displeje, polepy
      • polepy firemních vozidel, prodejen
      • navigační prvky - směrovky, cedule, plachty...
      `,
      examples: [
        {src: "../images/carousel/prod_3.jpg", projectName: "$out", url: "https://inzlin.info", hasBrightBG: true, hasBrightSubject: true},
        {src: "../images/carousel/prod_1.jpg", projectName: "adria_gold", tooltip: "Velké zmrzlinové kornouty před curkárnu."},
        {src: "../images/carousel/prod_6.jpg", projectName: "adria_gold", tooltip: "Štítky do zmrzlinových van."},
        {src: "../images/carousel/prod_7.jpg", projectName: "adria_gold", tooltip: "Držáky na kornouty."},
        {src: "../images/carousel/prod_8.jpg", projectName: "kovacs",  hasBrightBG: true, tooltip: "Rollupy pro prezentaci firmy na akcích." },
        {src: "../images/carousel/prod_9.jpg", projectName: "la_food", hasBrightBG: true, tooltip: "Katalog pro produktovou řadu MENU GOLD." },
      ]
    },



    "Digitální design": {
      key: "digitalni_design",
      blurb: "Digitální prezentace a weby, design eshopů, FB reklamy.",
      description: `
      • navrhneme a naprogramujeme prezentační weby
      • pomůžeme vám navrhnout obsahovou strukturu
      • vytvoříme obsah pro reklamní kampaň
      • zařídíme SEO optimalizaci
      `,
      examples: [
        {src: "images/carousel/digi_3.jpg",    projectName: "napacider", tooltip: "Reklamní FB kampaň pro Napa cider.", hasBrightBG: true, },
        {src: "images/carousel/napacider.jpg", projectName: "$out", url: "https://napacider.cz", tooltip: "Web pro Napa cider",  hasBrightBG: true, hasBrightSubject: true},
        {src: "images/carousel/digi_4.jpg",    projectName: "$out", url: "https://quatricise.com", tooltip: "Portfolio pro umělce a ilustrátora."},
      ]
    },



    "3D vizualizace": {
      key: "3d_vizualizace",
      blurb: "Vytvoříme 3D vizualizace na míru pro jakýkoliv produkt.",
      description: `
      Vytvoříme vizualizace:
      • do katalogů, 
      • pro web,
      • na polepy budov, aut, výloh
      `,
      examples: [
        {src: "images/carousel/3d_6.jpg", projectName: "kralovske_marmelady"},
        {src: "images/carousel/3d_2.jpg", projectName: "karima"},
        {src: "images/carousel/3d_3.jpg", projectName: "henna"},
        {src: "images/carousel/3d_4.jpg", projectName: "agro_jesenice"},
        {src: "images/carousel/3d_1.jpg", projectName: "vest"},
      ]
    },



    "Ilustrace": {
      key: "ilustrace",
      blurb: "Ozdobíme váš projekt originálními ilustracemi.",
      description: `
      • vytvoříme vám originální ilustrace pro váš projekt
      • navrhneme ilustrovaný plakát
      • digitální ilustrace - lineart, airbrush, comicbook-style, vektorová ilustrace, 3D art
      • analogové ilustrace - akvarel, tužka, perokresba či pastelová ilustrace
      `,
      examples: [
        {src: "images/carousel/ilu_1.jpg", projectName: "corston_and_william"},
        {src: "images/carousel/ilu_2.jpg", projectName: "brela"},
        {src: "images/carousel/ilu_3.jpg", projectName: "",                    hasBrightBG: true, hasBrightSubject: true, tooltip: "Banánové špagety, kresba pastelkama"},
        {src: "images/carousel/ilu_4.jpg", projectName: "kovacs",              hasBrightBG: true},
        {src: "images/carousel/ilu_5.jpg", projectName: "napacider",           hasBrightBG: true, hasBrightSubject: true},
        {src: "images/carousel/ilu_6.jpg", projectName: "kralovske_marmelady", hasBrightBG: true},
        {src: "images/carousel/ilu_7.jpg", projectName: "",                    hasBrightBG: true,  tooltip: "Low poly ilustrace brusinek"},
        {src: "images/carousel/ilu_8.jpg", projectName: "",                    hasBrightBG: true,  tooltip: "Kreslená pozvánka na firemní akci PPG"},
      ]
    },
  }

  static testDataValidity() {
    const validKeys = [
      "key",
      "blurb",
      "description",
      "examples",
    ]
    const requiredExampleKeys = [
      "src", "projectName"
    ]
    const allowedExampleKeys = requiredExampleKeys.concat(["hasBrightBG", "hasBrightSubject", "url", "tooltip"])

    for(let service in Services.list) {

      for(let key in Services.list[service]) {

        if(validKeys.find(k => k == key) == undefined)  throw `Invalid key in service ${service}: ${key}.`

        for(let [exampleIndex, example] of Services.list[service].examples.entries()) {

          for(let [index, reqKey] of requiredExampleKeys.entries()) {
            if(reqKey in example != true) {
              throw `Missing required key in ${service}, example index ${index}: ${reqKey}.`
            }
          }
          const exampleKeys = Object.keys(example)
          for(let exampleKey of exampleKeys) {
            if(!allowedExampleKeys.find(k => k === exampleKey)) throw `Service ${service} contains invalid key '${exampleKey}' in examples[${exampleIndex}].`

            if(exampleKey === "hasBrightBG" && example[exampleKey] !== undefined && typeof example[exampleKey] !== "boolean") {
              throw "hasBrightBG has to be of type boolean"
            }
            if(exampleKey === "hasBrightSubject" && example[exampleKey] !== undefined && typeof example[exampleKey] !== "boolean") {
              throw "hasBrightSubject has to be of type boolean"
            }
          }
        }
      }
    }
  }
}

class ServiceCard {
  constructor(/** @type string */ serviceName) {
    this.data = Services.list[serviceName]
    
    this.title = serviceName
    this.description = this.data.description ?? "MISSING!"
    this.flags = {
      visible: false
    }


    /* Create HTML */

    const container =         Create("div", {c: "service-card", s: "opacity=0"})
    const carouselContainer = Create("div", {c: "service-card--carousel-container"})

    const textContainer =     Create("div", {c: "service-card--text-container"})
    const title =             Create("h2",  {c: "service-card--title",              t: this.title})
    const description =       Create("p",   {c: "service-card--description",        t: this.description})
    const backgroundImg =     Create("img", {c: "service-card--background-image-v2", a:`src=../images/services_icons/${this.data.key}.png`})

    const borderTop =         Create("div", {c: "service-card--border-top"})
    const borderRight =       Create("div", {c: "service-card--border-right"})
    const borderLeft =        Create("div", {c: "service-card--border-left"})



    /* append */

    container.append(carouselContainer, textContainer, borderRight, borderLeft, borderTop)
    textContainer.append(title, description, backgroundImg)


    autoShy(description)
    autoNBSP(description, false)
    autoShy(title)


    /** @type Map<string, HTMLElement> */

    this.elements = new Map()
    this.elements.set("container", container)
    this.elements.set("carouselContainer", carouselContainer)
    this.elements.set("textContainer", textContainer)
    this.elements.set("borderRight", borderRight)
    this.elements.set("borderLeft", borderLeft)
    this.elements.set("borderTop", borderTop)



    Q(".services--section--cards").append(container)
    this.carousel = new Carousel(Services.list[serviceName].examples, carouselContainer)



    /* try a little animation on entry */
    this.show = (/** @type Event */ event, /** @type boolean */ force = false) => {
      if(this.flags.visible) return
      if(Page.current != "services") return

      const rect = container.getBoundingClientRect()
      if((rect.y < window.innerHeight && rect.bottom > 0) || force) {
        container.style.opacity = ""

        new Animate(container)
        .animate([
          {transform: "translateY(-10px)", opacity: "0"}, 
          {transform: "", opacity: "1"}
        ], 
          {duration: 900, easing: "cubic-bezier(0.2, 0.0, 0.3, 1.0)"}
        )

        new Animate(backgroundImg)
        .animate([
          {rotate: "-10deg",  scale: "0.98", translate: "5px 5px"},
          {rotate: "",      scale: "",     translate: ""},
        ], {
          duration: 3000,
          easing: "cubic-bezier(0.2, 0.2, 0.3, 1)",
        })

        document.removeEventListener("scroll", this.show)
        this.flags.visible = true
      }
    }
    document.addEventListener("scroll", this.show)



    ServiceCard.list.set(serviceName, this)
  }

  /** @type Map<string, ServiceCard> */
  static list = new Map()

  static async navigateToCard(name) {
    Page.applyState({page: "services"})
    const card = this.list.get(name)
    card.show(undefined, true)
    await wait(100)
    card.elements.get("container").scrollIntoView({block: "center", behavior: "smooth"})
  }
}

/** The small card for the homepage. */
class ServiceCardSmall {
  constructor(/** @type string */ serviceName) {
    this.data = Services.list[serviceName]

    const card =          Create("div",  {c: "service-card--small"})
    const glowContainer = Create("div",  {c: "service-card--small--glow-container"})
    const glow =          Create("div",  {c: "service-card--small--glow"})
    const background =    Create("img",  {c: "service-card--small--background", a: "src=../images/background_var_0.png"})
    const icon =          Create("img",  {c: "service-card--small--icon", a: `src=../images/services_icons_home/${this.data.key}.png`})
    const heading =       Create("span", {c: "service-card--small--heading", h: serviceName})
    const description =   Create("span", {c: "service-card--small--description", h: this.data.blurb})
    const borderBottom =  Create("div",  {c: "service-card--small--border--bottom"})
    const borderTop =     Create("div",  {c: "service-card--small--border--top"})

    card.append(background, icon, heading, description, borderBottom, borderTop, glowContainer)
    glowContainer.append(glow)

    autoShy(heading)
    autoShy(description)

    /* functionality */
    card.onclick = () => ServiceCard.navigateToCard(serviceName)
    
    this.elements = {card, glow, background, icon, heading, description, borderBottom, borderTop}
    
    Q(".intro-text--services").append(card)
    ServiceCardSmall.list.push(this)
  }
  updateGlowOnMouse(/** @type MouseEvent */ e) {
    if(this.elements.card.contains(e.target) === false) {
      this.elements.glow.style.opacity = "0"
      return
    }
    else {
      this.elements.glow.style.opacity = "0.10"
    }

    let card = this.elements.card.getBoundingClientRect()
    let glowRect = this.elements.glow.getBoundingClientRect()
    let [width, height] = [glowRect.width, glowRect.height]

    this.elements.glow.style.left = e.clientX - (width/2) - card.left + "px"
  }
  
  static list = []
}